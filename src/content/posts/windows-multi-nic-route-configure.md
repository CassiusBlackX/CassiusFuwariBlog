---
title: windows-multi-nic-route-configure
published: 2025-10-07
description: '当windows电脑上有多个网卡连接在不同网络下的时候如何配置每个网卡的路由'
image: ''
tags: ['network', 'Windows']
category: deployment
draft: false 
lang: ''
---
# Windows上多网卡配置不同的路由
## 需求分析
我的电脑上有多个网卡（如有线网+无线网，虽然我不止两个）的时候，不同的网卡是连接到不同的网络上的。一般来说，当然是有线网的网速和稳定性要更好，但是因为防火墙屏蔽，有线网无法访问**一个**公共资源。而又由于VLAN划分，无线网又无法访问一些内部资源。

虽然可以通过设置“跃点数”的方式，在Windows中简单的配置网卡的优先级，但是Windows并不会因为第一张网卡的连接失败后自动换另一张网卡重试，而是直接失败。因为对于网络的配置，操作系统都是直接根据路由表来进行选择。跃点数只有在等价的路由中，才会起作用。

在默认的情况下，有线网卡和无线网卡都是DHCP的，因此他们都会配置默认网关，而导致Windows会生成多条默认路由。而不管是防火墙屏蔽还是VLAN划分的原因，都不会直接在路由表上反应出来。在我的情况下，明明只有连接有线网才能够访问内部资源，只有连接无线网才能访问我的公共资源。但是电脑完全不知道这样的问题，以为我的有线和无线是等价的路由。

在这样的情况下，我希望，优先使用有线网，因为有线网能够访问绝大部分资源，但是当需要访问我的那**一个**公共资源的时候，通过无线网来访问。而要达到我的这个需求，可以通过添加静态路由+接口绑定的方式来实现。

## 静态路由+接口绑定
### 最长前缀匹配
在计网中就学过，为了尽可能的减少影响，在我只有**一个**公共资源需要专门访问的时候，应当是由尽可能长的前缀，以免“误伤”其它资源。因为我只是一个IP地址，所以直接添加一个`/32`的路由，让它走无线网卡，其余的流量继续走有线网卡就可以了。

### 操作
#### 确认无线网卡接口索引和网关
```powershell
route print
```
找到无线网卡的信息，例如
```
===========================================================================
接口列表
 10...00 e0 ed 52 8c aa ......Intel(R) Ethernet Server Adapter X520-2
 12...1c 1b 0d 5c 11 59 ......Intel(R) Ethernet Connection (2) I219-V
 15...50 2b 73 10 af b3 ......Microsoft Hosted Network Virtual Adapter
 17...50 2b 73 10 af b3 ......Realtek 8811CU Wireless LAN 802.11ac USB NIC
  8...f4 4e fc 8e 08 61 ......Bluetooth Device (Personal Area Network)
  1...........................Software Loopback Interface 1
===========================================================================
```
看名字易知，索引17的Wireless Lan是无线网卡

而也同样在这个命令中，可以看到，默认路由走的是无线网卡
```
IPv4 路由表
===========================================================================
活动路由:
网络目标        网络掩码          网关       接口   跃点数
          0.0.0.0          0.0.0.0         10.0.0.1        10.0.0.61     40  # 是我另外一个有线网卡的IP
          0.0.0.0          0.0.0.0         10.0.0.1        10.0.2.14     20  # 10.0.2.14就是我的有线网卡的IP，并且有更低的跃点数，默认使用这张网卡上网
```

#### 添加静态路由到指定网卡上
```cmd
route add my.vps.ip.address mask 255.255.255.255 10.157.0.1 if 17
```
+ 参数说明
  + `-p`[option]: 永久添加，否则只在本次电脑关机前有效
  + `my.vps.ip.address`: 需要访问的公共资源的IP
  + `mask 255.255.255.255`: 子网掩码，只匹配这个IP
  + `10.157.0.1`: 无线网卡的网关(下一跳)
  + `if 17`: 通过接口索引指定网卡

#### 检查
再次`route print`，查看是否新增了一条路由规则，如果新增了，则说明添加了。